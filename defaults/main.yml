---
# Default variables
# =================

# .. contents:: Sections
#    :local:
#
# ---------------------------
#   subnetwork configuration
# ---------------------------

# .. envvar:: subnetwork_iface
#
# Network interface to configure, by default a bridge.
subnetwork_iface: 'br2'

# .. envvar:: subnetwork_bridge_iface_regex
#
# Regular expression when matching ref:`subnetwork_iface` then
# ref:`subnetwork_iface` will be configured as bridge else it will be
# configured as interface.
subnetwork_bridge_iface_regex: '^(br|nat)*'


# .. envvar:: subnetwork_addresses
#
# Required! List of IPv4 and/or IPv6 addresses to configure on the bridge, in
# the "host/prefix" format.
subnetwork_addresses: []


# .. envvar:: subnetwork_bridge_ports
#
# Network interfaces to attach to a bridge on ifup.
subnetwork_bridge_ports: [ 'none' ]


# .. envvar:: subnetwork_forwarding
#
# Enable packet forwarding from internal network to the outside world.
subnetwork_forwarding: True


# .. envvar:: subnetwork_ipv4_nat
#
# Should IPv4 networking be configured behind NAT? You might want to disable
# this and configure routing elsewhere if you have a public IPv4 subnet which
# you want to use.
subnetwork_ipv4_nat: True


# .. envvar:: subnetwork_ipv4_nat_masquerade
#
# Should IPv4 traffic from the internal network be masqueraded? If disabled, static
# SNAT with the default IPv4 address of the gateway will be configured instead.
# Leave it True if you use a laptop or change networks frequently.
subnetwork_ipv4_nat_masquerade: True


# .. envvar:: subnetwork_ipv4_nat_snat_interface
#
# Network interface used as a source for outgoing IPv4 connections from NAT.
subnetwork_ipv4_nat_snat_interface: '{{ ansible_default_ipv4.interface | default("") }}'


# .. envvar:: subnetwork_options
#
# IPv4 network options.
subnetwork_options: |
  bridge_fd 0


# .. envvar:: subnetwork_options6
#
# IPv6 network options
subnetwork_options6: |
  pre-up echo 0 > /proc/sys/net/ipv6/conf/{{ subnetwork_iface }}/accept_dad


# .. envvar:: subnetwork_ifupdown_interfaces
#
# List of network interfaces to configure for the local network.
subnetwork_ifupdown_interfaces:

    # IPv4 network + bridge
  - iface: '{{ subnetwork_iface }}'
    type: '{% if subnetwork_iface | search(subnetwork_bridge_iface_regex) %}bridge{% else %}interface{% endif %}'
    inet: '{% if subnetwork_addresses | unique | ipv4("host/prefix") %}static{% else %}manual{% endif %}'
    addresses: '{{ subnetwork_addresses | unique | ipv4("host/prefix") }}'
    alias: 'subnetwork'
    weight: '40'
    bridge_ports: '{{ subnetwork_bridge_ports }}'
    options: '{{ subnetwork_options }}'

    # IPv6 network
  - iface: '{{ subnetwork_iface }}'
    type: 'interface'
    inet6: '{% if subnetwork_addresses | unique | ipv6("host/prefix") %}static{% else %}manual{% endif %}'
    addresses: '{{ subnetwork_addresses | unique | ipv6("host/prefix") }}'
    alias: 'subnetwork'
    weight: '40'
    auto: False
    allow: False
    options: '{{ subnetwork_options6 }}'

